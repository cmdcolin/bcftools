<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.15.dev">
<title>Consensus sequence</title>
<link rel="stylesheet" href="./index.css">
</head>
<body class="article">
<div id="header">
</div>
<div id="content">
<div class="sidebarblock navig">
<div class="content">
<div class="ulist">
<div class="title">General</div>
<ul>
<li>
<p><a href="index.html">Main page</a></p>
</li>
<li>
<p><a href="../bcftools.html">Manual page</a></p>
</li>
<li>
<p><a href="install.html">Installation</a></p>
</li>
<li>
<p><a href="publications.html">Publications</a></p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Calling</div>
<ul>
<li>
<p><a href="cnv-calling.html">CNV calling</a></p>
</li>
<li>
<p><a href="csq-calling.html">Consequence calling</a></p>
</li>
<li>
<p><a href="consensus-sequence.html">Consensus calling</a></p>
</li>
<li>
<p><a href="roh-calling.html">ROH calling</a></p>
</li>
<li>
<p><a href="variant-calling.html">Variant calling and filtering</a></p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Tips and Tricks</div>
<ul>
<li>
<p><a href="convert.html">Converting formats</a></p>
</li>
<li>
<p><a href="annotate.html">Adding annotation</a></p>
</li>
<li>
<p><a href="query.html">Extracting information</a></p>
</li>
<li>
<p><a href="filtering.html">Filtering expressions</a></p>
</li>
<li>
<p><a href="plugins.html">Plugins</a></p>
</li>
<li>
<p><a href="FAQ.html">FAQ</a></p>
</li>
</ul>
</div>
</div>
</div>
<div id="main">
<div class="sect1">
<h2 id="_consensus_sequence">Consensus sequence</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Sometimes there is the need to create a consensus sequence for an individual
where the sequence incorporates variants typed for this individual.
This is possible using the <code>consensus</code> command.</p>
</div>
<div class="paragraph">
<p>We need the reference sequence <code>reference.fa</code> in the fasta format
and an indexed VCF with the variants <code>calls.bcf</code>. The command is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>cat reference.fa | bcftools consensus calls.vcf.gz &gt; consensus.fa</pre>
</div>
</div>
<div class="paragraph">
<p>This assumes we have already made the calls, normalized indels and filtered. There is
<a href="variant-calling.html">another page</a> which goes deeper and is devoted just
to this, but in brief, the variant calling command in its simplest form is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># call variants
bcftools mpileup -Ou -f reference.fa alignments.bam | bcftools call -mv -Oz -o calls.vcf.gz
bcftools index calls.vcf.gz

# normalize indels
bcftools norm -f reference.fa calls.vcf.gz -Ob -o calls.norm.bcf

# filter adjacent indels within 5bp
bcftools filter --IndelGap 5 calls.norm.bcf -Ob -o calls.norm.flt-indels.bcf

# apply variants to create consensus sequence
cat reference.fa | bcftools consensus calls.vcf.gz &gt; consensus.fa

# output IUPAC ambiguity codes based on REF+ALT columns (regardless of genotype)
cat reference.fa | bcftools consensus --iupac-codes calls.vcf.gz &gt; consensus.fa

# output IUPAC ambiguity codes based on sample genotypes
cat reference.fa | bcftools consensus --haplotype I calls.vcf.gz &gt; consensus.fa</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Note:</strong> in order to keep the program relatively simple,
<code>consensus</code> merely applies variants from the VCF regardless of AF or other properties.
If more more advanced logic
is required, the VCF has to be preprocessed with other tools, such as the <code>+setGT</code> plugin
(see an example <a href="https://github.com/samtools/bcftools/issues/1516">here</a>).</p>
</div>
<div class="sect2">
<h3 id="_feedback">Feedback</h3>
<div class="paragraph">
<p>We welcome your feedback, please help us improve this page by 
either opening an <a href="https://github.com/samtools/bcftools/issues">issue on github</a> or <a href="https://github.com/samtools/bcftools/tree/gh-pages/howtos">editing it directly</a> and sending
a pull request.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
</div>
</div>
</body>
</html>