<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.16">
<title>Annotating VCF/BCF files</title>
<link rel="stylesheet" href="./index.css">
</head>
<body class="article">
<div id="header">
</div>
<div id="content">
<div class="sidebarblock navig">
<div class="content">
<div class="ulist">
<div class="title">General</div>
<ul>
<li>
<p><a href="index.html">Main page</a></p>
</li>
<li>
<p><a href="../bcftools.html">Manual page</a></p>
</li>
<li>
<p><a href="install.html">Installation</a></p>
</li>
<li>
<p><a href="publications.html">Publications</a></p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Calling</div>
<ul>
<li>
<p><a href="cnv-calling.html">CNV calling</a></p>
</li>
<li>
<p><a href="csq-calling.html">Consequence calling</a></p>
</li>
<li>
<p><a href="consensus-sequence.html">Consensus calling</a></p>
</li>
<li>
<p><a href="roh-calling.html">ROH calling</a></p>
</li>
<li>
<p><a href="variant-calling.html">Variant calling and filtering</a></p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Tips and Tricks</div>
<ul>
<li>
<p><a href="convert.html">Converting formats</a></p>
</li>
<li>
<p><a href="annotate.html">Adding annotation</a></p>
</li>
<li>
<p><a href="query.html">Extracting information</a></p>
</li>
<li>
<p><a href="filtering.html">Filtering expressions</a></p>
</li>
<li>
<p><a href="plugins.html">Plugins</a></p>
</li>
<li>
<p><a href="FAQ.html">FAQ</a></p>
</li>
</ul>
</div>
</div>
</div>
<div id="main">
<div class="sect1">
<h2 id="_annotating_vcfbcf_files">Annotating VCF/BCF files</h2>
<div class="sectionbody">
<div class="paragraph">
<div class="title"><strong>Remove annotations</strong></div>
<p>Set the ID column to <code>.</code> and remove INFO/DP and FORMAT/DP annotations</p>
</div>
<div class="listingblock">
<div class="content">
<pre>bcftools annotate -x ID,INFO/DP,FORMAT/DP file.vcf.gz</pre>
</div>
</div>
<div class="paragraph">
<p>Remove all INFO fields and all FORMAT fields except for GT and PL</p>
</div>
<div class="listingblock">
<div class="content">
<pre>bcftools annotate -x INFO,^FORMAT/GT,FORMAT/PL file.vcf</pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>Rename annotations</strong></div>
<div class="content">
<pre># rename INFO tag `OldName` to `NewName`
bcftools annotate -c INFO/NewName:=INFO/OldName file.vcf

# rename FILTER `OldName` to `NewName`
bcftools annotate -c FILTER/NewName:=FILTER/OldName file.vcf</pre>
</div>
</div>
<div class="paragraph">
<div class="title"><strong>Transfer annotations from one VCF file to another</strong></div>
<p>Populate the columns ID, QUAL and the INFO/TAG annotation</p>
</div>
<div class="listingblock">
<div class="content">
<pre># do not replace TAG if already present
bcftools annotate -a src.bcf -c ID,QUAL,+TAG dst.bcf

# overwrite existing TAG annotations
bcftools annotate -a src.bcf -c ID,QUAL,TAG dst.bcf</pre>
</div>
</div>
<div class="paragraph">
<p>Carry over all INFO and FORMAT annotations except FORMAT/GT</p>
</div>
<div class="listingblock">
<div class="content">
<pre>bcftools annotate -a src.bcf -c INFO,^FORMAT/GT dst.bcf</pre>
</div>
</div>
<div class="paragraph">
<p>Carry over FILTER column</p>
</div>
<div class="listingblock">
<div class="content">
<pre>bcftools annotate -a src.bcf -c FILTER dst.bcf</pre>
</div>
</div>
<div class="paragraph">
<div class="title"><strong>Transfer annotations from a tab-delimited text file to a VCF</strong></div>
<p>The following command can be used to transfer values from a tab-delimited
file into a new INFO/TAG annotation. Note that if the TAG is not
defined in the VCF header, a header fragment with the definition must
be provided via the <code>-h</code> option.</p>
</div>
<div class="listingblock">
<div class="content">
<pre># Annotate from a tab-delimited file with six columns (the fifth is ignored),
# first indexing with tabix. The coordinates in the text file are 1-based, same
# as the coordinates in the VCF
tabix -s1 -b2 -e2 annots.tab.gz
bcftools annotate -a annots.tab.gz -h annots.hdr -c CHROM,POS,REF,ALT,-,TAG file.vcf


# Annotate from a tab-delimited file with regions (1-based coordinates, inclusive)
tabix -s1 -b2 -e3 annots.tab.gz
bcftools annotate -a annots.tab.gz -h annots.hdr -c CHROM,FROM,TO,TAG input.vcf


# Annotate from a bed file (0-based coordinates, half-closed, half-open intervals)
bcftools annotate -a annots.bed.gz -h annots.hdr -c CHROM,FROM,TO,TAG input.vcf</pre>
</div>
</div>
<div class="paragraph">
<div class="title"><strong>Overwriting versus not overwriting existing tags and the handling of missing values</strong></div>
<p>Modifiers that control what to do with missing values:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 70%;">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-c TAG</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add TAG if the source value is not missing (&#8220;.&#8221;). If TAG exists in the target file, it will be overwritten</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-c +TAG</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add TAG if the source value is not missing and TAG is not present in the target file.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-c .TAG</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add TAG even if the source value is missing. This can overwrite non-missing values with a missing value
  and can create empty VCF fields (<code>TAG=.</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-c .+TAG</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add TAG even if the source value is missing but only if TAG does not exist in the target file; existing
  tags will not be overwritten.</p></td>
</tr>
</tbody>
</table>
<div id="transfer_filter_to_info" class="listingblock">
<div class="title"><strong>Transfer FILTER values into an INFO tag</strong></div>
<div class="content">
<pre># transfer FILTER column to INFO tag NewTag; notice that the -a option is not present, therefore
# B.bcf/FILTER is the source annotation
bcftools annotate -c INFO/NewTag:=FILTER B.bcf

# transfer FILTER column from A.bcf to INFO/NewTag in B.bcf; notice that the -a option is present,
# therefore A.bcf/FILTER is the source annotation
bcftools annotate -c INFO/NewTag:=FILTER -a A.bcf B.bcf

# transfer B.bcf/FILTER column to INFO tag NewTag; notice that although the -a option is present,
# the notation "./FILTER" tells the program to transfer the annotation locally and make B.bcf/FILTER
# the source annotation
bcftools annotate -c INFO/NewTag:=./FILTER -a A.bcf B.bcf

# transfer B.bcf/FILTER column to INFO/NewTag, then A.bcf/FILTER to B.bcf/FILTER
bcftools annotate -c INFO/NewTag:=./FILTER,FILTER -a A.bcf B.bcf

# transfer A.bcf/FILTER to B.bcf/FILTER, then the new B.bcf/FILTER value to INFO/NewTag; notice
# that due to the order of operation, FILTER and INFO/NewTag will be identical
bcftools annotate -c FILTER,INFO/NewTag:=./FILTER -a A.bcf B.bcf</pre>
</div>
</div>
<div class="paragraph">
<div class="title"><strong>Transfer annotation from INFO column to FORMAT</strong></div>
<p>Imagine you need to transfer INFO/DP annotation to FORMAT/DP. This is currently not possible
using a single <code>bcftools annotate</code> command, but can be done easily in multiple steps.
This is a complete example that can be copy and pasted as is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># Create a test VCF
echo -e '##fileformat=VCFv4.3' &gt; test.vcf
echo -e '##INFO=&lt;ID=DP,Number=1,Type=Integer,Description="Read depth"&gt;' &gt;&gt; test.vcf
echo -e '##FORMAT=&lt;ID=GT,Number=1,Type=String,Description="Genotype"&gt;' &gt;&gt; test.vcf
echo -e '##contig=&lt;ID=1,length=248956422,assembly=hg38&gt;' &gt;&gt; test.vcf
echo -e '#CHROM\tPOS\tID\tREF\tALT\tQUAL\tFILTER\tINFO\tFORMAT\tsmpl1\tsmpl2' &gt;&gt; test.vcf
echo -e '1\t16648016\t.\tG\t.\t.\t.\tDP=10\tGT\t0/0\t0/0' &gt;&gt; test.vcf

# Extract INFO/DP into a tab-delimited annotation file
bcftools query -f '%CHROM\t%POS\t%DP\n' test.vcf | bgzip -c &gt; annot.txt.gz

# Index the file with tabix
tabix -s1 -b2 -e2 annot.txt.gz

# Create a header line for the new annotation
echo -e '##FORMAT=&lt;ID=DP,Number=1,Type=Integer,Description="Read depth"&gt;' &gt;&gt; hdr.txt

# Transfer the annotation to sample 'smpl1'
bcftools annotate -s smpl1 -a annot.txt.gz -h hdr.txt -c CHROM,POS,FORMAT/DP test.vcf</pre>
</div>
</div>
<div class="sect2">
<h3 id="_feedback">Feedback</h3>
<div class="paragraph">
<p>We welcome your feedback, please help us improve this page by 
either opening an <a href="https://github.com/samtools/bcftools/issues">issue on github</a> or <a href="https://github.com/samtools/bcftools/tree/gh-pages/howtos">editing it directly</a> and sending
a pull request.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
</div>
</div>
</body>
</html>